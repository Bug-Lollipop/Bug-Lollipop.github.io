<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	åº”ç”¨åŒ…æ‰“åŒ…ä½“ç§¯ä¼˜åŒ– - Akira's blog
  	
	</title

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="Akira's blog" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>
	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	#sub-nav .social a.weibo {
		background: url('asset/images/social/weibo.png?1419407210') center no-repeat #4ec4fa;
		border: 1px solid #4ec4fa;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	article .entry-content table th,article .entry-content table td{ padding: 4px;border-collapse: collapse; border:solid 1px #ddd;}
	</style>
	
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
					<div class="profilepic">
						<img src="asset/icon.jpg" style="width:160px;">
					</div>
					<h1><a href="index.html">Akira's blog</a></h1>
					<p class="subtitle">è®°å½•ä¸€äº›æŠ€æœ¯æ–‡ç« </p>
					<nav id="main-nav">
						<ul class="main">
							<li><a href="index.html">Home</a></li>
						    <li><a href="all.html">Blog</a></li>
						    <li><a href="archives.html">Archives</a></li>
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<!-- 
			<a class="email" href="mailto:" title="Email">Email</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
			<a class="google" href="https://plus.google.com/" rel="author" title="Google+">Google+</a>
			<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
			<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
			<a class="coderwall" href="https://coderwall.com/" title="Coderwall">Coderwall</a>
		    <a class="stackoverflow" href="http://stackoverflow.com/users/" title="StackOverflow"></a>
			<a class="linkedin" href="http://www.linkedin.com/in/" title="LinkedIn">LinkedIn</a>
			<a class="pinterest" href="https://pinterest.com/" title="Pinterest">Pinterest</a>
			<a class="delicious" href="http://delicious.com/" title="Delicious">Delicious</a>
			<a class="pinboard" href="https://pinboard.in/u:" title="Pinboard">Pinboard</a>
			<a class="douban" href="https://www.douban.com/people/" title="Douban">Douban</a>
			<a class="quora" href="https://quora.com/" title="Quora">Quora</a>
			<a class="instagram" href="https://instagram.com/" title="Instagram">Instagram</a>
			<a class="behance" href="https://www.behance.net/" title="Behance">Behance</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
-->	
								<a class="email" href="mailto:huixiao1008@gmail.com" title="Email">Email</a>
								<a class="weibo" target="_blank" href="https://weibo.com/u/2554601764" title="weibo">Weibo</a>
								
								<a class="github" target="_blank" href="https://github.com/Bug-Lollipop" title="GitHub">GitHub</a>
								<!-- <a class="twitter" target="_blank" href="http://twitter.com/oulvhai" title="Twitter">Twitter</a> -->
								<!-- <a class="rss" href="atom.xml" title="RSS">RSS</a> -->
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">

			<div class="mid-col-container">
		

			
 <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">åº”ç”¨åŒ…æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–</h1>
		<div class="entry-content" itemprop="articleBody">
			<p>ä¸€ä¸ªæ¥æ‰‹çš„Vueå¤–éƒ¨é¡¹ç›®ï¼Œbuild éå¸¸æ…¢ï¼Œè¯•ç€å»ä¼˜åŒ–ä¸€æ³¢ã€‚<br/>
é¦–å…ˆä½¿ç”¨ webpack-bundle-analyzer æ¥åˆ†æä¸€æ³¢æ˜¯å“ªäº›æ–‡ä»¶é€ æˆçš„ï¼š</p>

<h3 id="toc_0">å®‰è£…</h3>

<p>é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š</p>

<pre><code>npm install --save-dev webpack-bundle-analyzer
</code></pre>

<h3 id="toc_1">é…ç½®</h3>

<p>åœ¨ä½¿ç”¨vue-cliç”Ÿæˆçš„è„šæ‰‹æ¶æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ä¿®æ”¹buildæ–‡ä»¶å¤¹ä¸‹çš„webpack.prod.conf.jsï¼š</p>

<span id="more"></span><!-- more -->

<h3 id="toc_2">å¼•å…¥æ¨¡å—</h3>

<pre><code>const BundleAnalyzerPlugin = require(&#39;webpack-bundle-analyzer&#39;).BundleAnalyzerPlugin;

// ...
plugins: [
  // ...
  new BundleAnalyzerPlugin(),
]
// ...
</code></pre>

<p>é€šè¿‡æ’ä»¶ç”Ÿæˆçš„åŒ…ç»“æ„å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="media/15284430142953/15284434767551.jpg" alt=""/></p>

<p><img src="media/15284430142953/15284434902123.jpg" alt="img" style="width:300px;"/></p>

<p>å¯ä»¥çœ‹å‡ºvendor.js å¾ˆå¤§äº†ï¼Œé¦–å…ˆå¼€å§‹æ‹†vendor:</p>

<h4 id="toc_3">lodash</h4>

<p>è¿™é‡Œlodash æ²¡æœ‰æŒ‰éœ€åŠ è½½ï¼Œå¯¼è‡´åŒ…å¾ˆå¤§ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰éœ€æ‰“åŒ…lodash<br/>
lodash å®˜æ–¹ä¸ºæ¯ä¸ªæ–¹æ³•éƒ½ç»´æŠ¤äº†ç‹¬ç«‹çš„ npm åŒ…ï¼š</p>

<h5 id="toc_4">method packages</h5>

<pre><code>// npm install lodash.add
import add from &#39;lodash.add&#39;;
// npm install lodash.cloneDeep
import cloneDeep from &#39;lodash.cloneDeep&#39;;
</code></pre>

<p>ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ç€ä»¥ä¸‹ç¼ºé™·ï¼š</p>

<ul>
<li>æ¯å½“ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ–¹æ³•å°±éœ€è¦å®‰è£…ä¸€ä¸ªæ–°çš„ npm package</li>
<li>npm packge é—´å­˜åœ¨ä¸€äº›é‡å¤å…¬ç”¨æ–¹æ³•ä¸”æ— æ³•ä¼˜åŒ–</li>
<li>æ¯ä¸€ä¸ªæ–¹æ³•éƒ½éœ€è¦å•ç‹¬å†™ä¸€è¡Œ import</li>
<li>lodash V5.0.0 å°†ä¼šæ”¾å¼ƒå¯¹è¿™äº›æ¨¡å—çš„ç»´æŠ¤</li>
</ul>

<h5 id="toc_5">cherry-pick</h5>

<p>åœ¨ lodash æºç ä¸­ï¼Œæ‰€æœ‰çš„æ–¹æ³•è¢«ç»„ç»‡åœ¨ä¸€ä¸ªä¸ªåŒåçš„æ–‡ä»¶ä¸­ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ç›´æ¥å¼•ç”¨æºç æ¥å®ç°æŒ‰éœ€å¼•å…¥çš„ç›®çš„ï¼Œè¿™ç§æ–¹å¼è¢«å®˜æ–¹ç§°ä¸º cherry-pickã€‚</p>

<pre><code>import add from &#39;lodash/add&#39;;
import cloneDeep from &#39;lodash/cloneDeep&#39;;
</code></pre>

<p>cherry-pick è™½ç„¶åªéœ€å®‰è£…ä¸€ä¸ª lodash åŒ…ï¼Œä½†æ˜¯æœ‰æ—¶è¿˜æ˜¯è¦å†™å¾ˆå¤šè¡Œçš„ importã€‚</p>

<p>è¿™è¿™ä¸ªé¡¹ç›®ä¸­ æˆ‘ä»¬å‘ç°åªç”¨åˆ°äº†lodash çš„ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨cherry-pick å¼•å…¥è¯¥æ–¹æ³•ã€‚é‡æ–°build ä¹‹åï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹åŒ…ä½“ç§¯ï¼š</p>

<p><img src="media/15284430142953/15284449340411.jpg" alt=""/></p>

<p>æ­¤æ—¶lodash æ‰“åŒ…è‚‰çœ¼å¯è§çš„å˜å°äº†ï¼Œå†çœ‹ä¸€ä¸‹æ•´ä¸ªåŒ…ä½“ç§¯å˜åŒ–ï¼š</p>

<p><img src="media/15284430142953/15284449761856.jpg" alt="img" style="width:400px;"/></p>

<p>ç›¸æ¯”è¾ƒä¹‹å‰ï¼Œå°äº†0.4MBï¼Œæ¥ç€æˆ‘ä»¬å†å¯¹moment.js è¿›è¡Œæ”¹é€ ï¼š<br/>
å¯¹äº moment.js è¿™ç§å…¨è€Œå¤§çš„ JS æ—¶é—´åº“ï¼Œè™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯çœŸçš„æ˜¯å¤ªé‡äº†ï¼Œè€Œä¸”ä¸€ä¸ªé¡¹ç›®å¯èƒ½åªéœ€è¦ä½¿ç”¨å…¶ä¸­å‡ ä¸ªå¸¸è§çš„APIã€‚æ­¤æ—¶å¦‚æœæƒ³è¦ä¼˜åŒ–moment çš„ä½“ç§¯ï¼Œå¯ä»¥ä½¿ç”¨Day.js ä»£æ›¿ï¼ŒDay.js æ˜¯ä¸€ä¸ªè½»é‡çš„ JavaScript æ—¶é—´æ—¥æœŸå¤„ç†åº“ï¼Œå’Œ Moment.js çš„ API è®¾è®¡ä¿æŒå®Œå…¨ä¸€æ ·. å¦‚æœä½ æ›¾ç»ç”¨è¿‡ Moment.js, é‚£ä¹ˆä½ å·²ç»çŸ¥é“å¦‚ä½•ä½¿ç”¨ Day.js</p>

<p>Day.js çš„åŸºæœ¬æ“ä½œå¦‚ä¸‹ï¼Œç›¸åŒçš„APIï¼Œç›¸åŒçš„é“¾å¼æ“ä½œï¼š</p>

<pre><code>dayjs().startOf(&#39;month&#39;).add(1, &#39;day&#39;).set(&#39;year&#39;, 2018).format(&#39;YYYY-MM-DD HH:mm:ss&#39;);
</code></pre>

<p>ç‰¹ç‚¹ï¼š<br/>
ğŸ•’ å’Œ Moment.js ç›¸åŒçš„ API å’Œç”¨æ³•<br/>
ğŸ’ª ä¸å¯å˜æ•°æ® (Immutable)<br/>
ğŸ”¥ æ”¯æŒé“¾å¼æ“ä½œ (Chainable)<br/>
ğŸŒ I18n å›½é™…åŒ–<br/>
ğŸ“¦ ä»… 2kb å¤§å°çš„å¾®å‹åº“<br/>
ğŸ‘« å…¨æµè§ˆå™¨å…¼å®¹</p>

<p>éº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ï¼ŒDay.js åŒ…å«äº†æ—¶é—´å¤„ç†çš„å…¨éƒ¨å¸¸ç”¨æ–¹æ³•ï¼Œå¹¶ä¸”ä»…ä»…æœ‰ 2kb å¤§å°ã€‚å› æ­¤æƒ³ç¼©å°æ‰“åŒ…ä½“ç§¯ï¼Œæå‡å¼€å‘ä½“éªŒåªéœ€è¦replace(/moment/g, &#39;dayjs&#39;) å…¨å±€æ›¿æ¢ä¸€ä¸‹ã€‚å°±èƒ½ä» Moment.js + locals 200kb å‡å°æˆ dayjs 2kbçš„ä½“ç§¯ã€‚æ‰€æœ‰çš„APIè°ƒç”¨éƒ½ä¿æŒä¸å˜ï¼Œæ— éœ€ä¿®æ”¹ã€‚</p>

<p>è¿™æ¬¡æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ æ”¹ä¸ºDay.js ä¹‹åçš„æ‰“åŒ…ä½“ç§¯å¤§å°ï¼š<br/>
<img src="media/15284430142953/15284471455127.jpg" alt=""/></p>

<p><img src="media/15284430142953/15284471595449.jpg" alt="img" style="width:400px;"/></p>

<p>æ­¤æ—¶Day.js å·²ç»å°åˆ°åœ¨è¿™å¼ å›¾ä¸Šæ¶ˆå¤±äº†ï¼Œè€ŒTreeMap å¤§å°åˆç¼©å°äº† 0.5M ã€‚</p>

<p>æ¥ä¸‹æ¥æœ€åçš„å¤§å¤´æ˜¯ element-ui ï¼Œelement-uiæœ¬èº«æ”¯æŒæŒ‰éœ€å¼•å…¥ï¼Œä¸è¿‡å¯¹äºè¯¥é¡¹ç›®ï¼Œå…¨å±€æœç´¢äº†ä¸€éï¼Œå‘ç°è¢«ç”¨åˆ°çš„ç»„ä»¶éå¸¸å¤šï¼Œè¿™ä¸ªæ—¶å€™è¦ä»”ç»†æ–‡ä»¶ï¼Œé˜²æ­¢è¢«æ¼æ‰æŸäº›ç»„ä»¶ã€‚å…·ä½“æŒ‰éœ€å¼•å…¥çš„çš„æ–¹å¼element-ui å®˜æ–¹æ–‡æ¡£æœ‰å¾ˆè¯¦ç»†çš„ä»‹ç»ï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰“åŒ…çš„ä½“ç§¯ï¼š<br/>
<img src="media/15284430142953/15284544180604.jpg" alt=""/><br/>
<img src="media/15284430142953/15284544340569.jpg" alt="img" style="width:400px;"/></p>

<p>æ­¤æ—¶Treemap size åˆå‡å°‘äº†0.2MBã€‚æœ€åæˆ‘ä»¬å¯ä»¥ Code Splittingï¼Œå°†ä»£ç åˆ†æˆä¸€å—ä¸€å—ï¼Œæå‡åŠ è½½é€Ÿåº¦ï¼š<br/>
å…·ä½“å¯ä»¥çœ‹<a href="https://zhuanlan.zhihu.com/p/26710831">Webpack å¤§æ³•ä¹‹ Code Splitting</a> æœ€åæˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„ä½“ç§¯ç»“æ„å¦‚ä¸‹ï¼š<br/>
<img src="media/15284430142953/15284560084587.jpg" alt=""/></p>

<p><img src="media/15284430142953/15284560220358.jpg" alt="img" style="width:400px;"/></p>

<p>æˆ‘ä»¬çœ‹åˆ° æ¯ä¸ªrouter çš„ js éƒ½å•ç‹¬å‡ºæ¥äº†ï¼Œè¿™æ ·å­æœ‰ç¼©å°äº† 0.2MB çš„ä½“ç§¯ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Vendor è¿˜æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯æ¯•ç«Ÿå¯¹äºè¿™ä¸ªé¡¹ç›®æ¥è¯´ï¼Œä¸šåŠ¡å¾ˆé‡çš„å¤§ç³»ç»Ÿï¼Œä¸å¯é¿å…ä¼šè¿™æ ·ï¼Œä½†æ˜¯ç›¸æ¯”ä¼˜åŒ–ä¹‹å‰ï¼Œå·²ç»å¥½å¾ˆå¤šäº†ï¼ŒTreemap size 2.06M =&gt; 1.85Mã€‚</p>

		</div>
	</article>
<div class="share-comment">

</div>


</div>        </div>
	
	</div>
<script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

</body>
</html>